<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Izinkan Notifikasi</title>
</head>
<body>
    <h2>Izinkan Notifikasi</h2>
    <p>Anda harus mengizinkan notifikasi untuk melanjutkan ke halaman login.</p>
    <button onclick="mintaNotifikasi()">Klik untuk Mengizinkan</button>

    <script>
        function getParameterByName(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        function mintaNotifikasi() {
            Notification.requestPermission().then(function (permission) {
                console.log("Hasil izin:", permission);

                if (permission === "granted") {
                    console.log("Izin diberikan, menyimpan status...");
                    localStorage.setItem("notif_allowed", "true"); // Simpan agar tidak meminta ulang
                    alert("Terima kasih! Anda akan menerima notifikasi.");

                    // Redirect ke halaman login
                    const redirectUrl = getParameterByName("redirect");
                    if (redirectUrl) {
                        window.location.href = redirectUrl;
                    }
                } else {
                    console.log("Izin ditolak, tetap di halaman ini.");
                    alert("Anda menolak notifikasi, silakan izinkan untuk melanjutkan.");
                }
            });
        }

        // Cek apakah izin sudah diberikan sebelumnya
        document.addEventListener("DOMContentLoaded", function () {
            console.log("Memeriksa status izin...");
            if (Notification.permission === "granted" || localStorage.getItem("notif_allowed") === "true") {
                console.log("Notifikasi sudah diizinkan, langsung ke halaman login.");
                const redirectUrl = getParameterByName("redirect");
                if (redirectUrl) {
                    window.location.href = redirectUrl;
                }
            }
        });
    </script>
</body>
</html>
